#!/usr/bin/python
from apt_venv import AptVenv, utils, VERSION
from argparse import ArgumentParser

def main():
    parser = ArgumentParser(prog='apt-venv')
    parser.add_argument('-D', '--debug', type=int, help='set debug level')
    parser.add_argument('-v', '--version', action='version', \
        version='%(prog)s ' + VERSION)

    parser.add_argument('-d', '--delete', action="store_true",
        default=False, help="delete venv for release")
    parser.add_argument('-c', '--command',
        help="exec the command in venv")
    parser.add_argument('release',
        help="the debian/ubuntu release")

    args = parser.parse_args()

    if args.debug:
        utils.DEBUG_LEVEL = args.debug

    try:
        venv = AptVenv(args.release)
        if args.delete:
            venv.delete()
        else:
            if not venv.exists():
                venv.create()
                print("Welcome to apt virtual enviroment for %s release." % \
                        venv.release)
                print("You may want run first \"apt-get update\"")
            venv.run(command=args.command)

    except ValueError as exception:
        print (str(exception))
        exit(1)

if __name__ == '__main__':
    main()
